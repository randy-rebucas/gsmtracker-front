<div class="primary-header">
    <h1>Patients</h1>
</div>
<div class="wrapper">
    <div gdAreas="header header | content side | footer footer" gdGap="10px" gdRows="auto auto auto" gdColumns="auto 350px" gdAreas.lt-md="header | content | side | footer" gdRows.lt-md="auto auto auto auto" gdColumns.lt-md="auto">
        <div class="area header" gdArea="header">
            <div fxLayout='row'>
                <div class="search-div" fxFlex="80" fxFlex.sm="100%" fxFlex.md="90%">
                    <mat-form-field>
                        <input matInput (keyup)="applyFilter($event.target.value)" placeholder="Search" autocomplete="off">
                    </mat-form-field>
                    <div (click)="onScan()">
                        <img src="https://img.icons8.com/material/24/000000/qr-code--v1.png">
                    </div>
                </div>
                <div class="action-button" fxFlex="20" fxFlex.sm="100%" fxFlex.md="20%">
                    <!-- <button mat-flat-button color="accent" (click)="onPrint()" [disabled]="!isAllSelected()">
            <mat-icon>print</mat-icon> Print
          </button> -->
                    <!-- <button mat-flat-button color="warn" (click)="onDelete()" [disabled]="!isAllSelected()">
            <mat-icon>delete_sweep</mat-icon> Delete
          </button> -->
                    <button mat-flat-button color="primary" (click)="onCreate(userTypeId)">
            <mat-icon>add</mat-icon> Add New
          </button>
                </div>
            </div>
        </div>

        <div class="area content" gdArea="content">
            <!-- table -->
            <mat-table [dataSource]="dataSource" multiTemplateDataRows style="width: 100%;">

                <ng-container matColumnDef="{{column}}" *ngFor="let column of columnsToDisplay">
                    <div *ngIf="column === 'image'">
                        <mat-header-cell *matHeaderCellDef> &nbsp; </mat-header-cell>
                        <mat-cell *matCellDef="let element">
                            <div *ngIf="element.avatar; then thenBlock else elseBlock"></div>
                            <ng-template #thenBlock>
                                <img [src]="element.avatar" [alt]="element.firstname" style="width:40px; height:40px; vertical-align: middle;border-radius: 100%;" />
                            </ng-template>
                            <ng-template #elseBlock>
                                <app-avatar [firstname]="element.firstname" [lastname]="element.lastname"></app-avatar>
                            </ng-template>
                        </mat-cell>
                    </div>
                    <div *ngIf="column === 'action'; then thenBlockRow else elseBlockRow"></div>
                    <ng-template #thenBlockRow>
                        <mat-header-cell *matHeaderCellDef style="text-align: right;">
                        </mat-header-cell>
                        <mat-cell *matCellDef="let element">
                            <ng-container *ngIf="element.isOwned">
                                <button mat-icon-button (click)="onEdit(userTypeId, element.id)" aria-label="Edit" title="Edit">
                                    <mat-icon>launch</mat-icon>
                                  </button>
                                  <button mat-icon-button color="warn" (click)="onDelete(element.id)" aria-label="Delete" title="Delete">
                                    <mat-icon>delete</mat-icon>
                                  </button>
                            </ng-container>

                        </mat-cell>
                    </ng-template>
                    <ng-template #elseBlockRow>
                        <mat-header-cell *matHeaderCellDef> {{column | titlecase}} </mat-header-cell>
                        <div *ngIf="column === 'birthdate'; then thenBlockDate else elseBlockDate"></div>
                        <ng-template #thenBlockDate>
                            <mat-cell *matCellDef="let element"> {{ element[column] | date }}</mat-cell>
                        </ng-template>
                        <ng-template [ngIf]="column === 'age'">
                            <mat-cell *matCellDef="let element"> {{ element.birthdate | birthday }}</mat-cell>
                        </ng-template>
                        <ng-template #elseBlockDate>
                            <mat-cell *matCellDef="let element"> {{ element[column] }}</mat-cell>
                        </ng-template>
                    </ng-template>

                </ng-container>


                <ng-container matColumnDef="expandedDetail">
                    <mat-cell *matCellDef="let element" [attr.colspan]="columnsToDisplay.length">
                        <div class="element-detail" [@detailExpand]="element == expandedElement ? 'expanded' : 'collapsed'">
                            <div class="element element-description">
                                <ul class="addresses">
                                    <li>Addresses:</li>
                                    <li *ngFor="let address of element.address; let i = index;" [ngClass]="{'current': address.current}">
                                        {{address.address1}}
                                        <br/>
                                        <ng-container *ngIf="address.address2">
                                            {{address.address2}} <br/>
                                        </ng-container>
                                        {{address.postalCode}} {{address.province}}, {{address.city}}<br/> {{address.country}}
                                    </li>
                                </ul>
                            </div>
                            <div class="element element-metadata">
                                <ul class="metadata">
                                    <li>Meta Data:</li>
                                    <li *ngFor="let meta of element.meta; let m = index;">
                                        <ng-container *ngIf="meta.label != ''">{{meta.label}}: <span>{{meta.value}}</span></ng-container>
                                        <ng-container *ngIf="meta.label == ''">--</ng-container>
                                    </li>
                                </ul>
                            </div>
                            <div class="element element-physicians">
                                <!--physicians-->
                                <app-physicians [physicians]="element.physicians"></app-physicians>
                            </div>
                            <button mat-icon-button [routerLink]="['../', element.id, 'record']" aria-label="Record" title="Record">
                              <mat-icon>assignment</mat-icon>
                            </button>
                        </div>
                    </mat-cell>
                </ng-container>

                <mat-header-row *matHeaderRowDef="columnsToDisplay"></mat-header-row>
                <mat-row matRipple *matRowDef="let element; columns: columnsToDisplay;" class="element-row" [class.expanded-row]="expandedElement === element" (click)="expandedElement = expandedElement === element ? null : element">
                </mat-row>
                <mat-row *matRowDef="let row; columns: ['expandedDetail']" class="detail-row"></mat-row>

                <ng-container matColumnDef="loading">
                    <mat-footer-cell *matFooterCellDef colspan="8">
                        <p class="mat-body">Loading data...</p>
                    </mat-footer-cell>
                </ng-container>
                <ng-container matColumnDef="noData">
                    <mat-footer-cell *matFooterCellDef colspan="8">
                        <p class="mat-body">No patient data.</p>
                    </mat-footer-cell>
                </ng-container>
                <mat-footer-row *matFooterRowDef="['loading']" [ngClass]="{'hide': dataSource!=null}"></mat-footer-row>
                <mat-footer-row *matFooterRowDef="['noData']" [ngClass]="{'hide': !(dataSource!=null && dataSource.data.length==0)}"></mat-footer-row>
            </mat-table>
            <mat-paginator [pageSizeOptions]="pageSizeOptions" [pageSize]="perPage"></mat-paginator>
        </div>
        <div class="area side" gdArea="side">
            <!--birthdays-->
            <app-birthdays></app-birthdays>

        </div>
        <div class="area footer" gdArea="footer">

        </div>
    </div>
</div>
